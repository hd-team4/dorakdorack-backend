package dorakdorak.infra.openai;

import dorakdorak.infra.openai.exception.OpenAiVisionException;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import static org.assertj.core.api.Assertions.*;

@SpringBootTest
class OpenAiVisionClientTest {

    @Autowired
    private OpenAiVisionClient openAiVisionClient;

    @Test
    @DisplayName("잔반 비율이 10% 미만일 경우 - 인증 성공 가능")
    void analyzeRemainPercent_success_under10() {
        // 이미지: 거의 다 먹은 도시락
        String imageUrl = "https://mblogthumb-phinf.pstatic.net/MjAyMjA1MTdfOSAg/MDAxNjUyNzY3NTE4MjE4.2MObntGr4CTFjKgaWIdcvt9v-5LrTGr3HA7ZNv4n3HYg.hbo3TQfuFNmPs_2bfwUwJQitnm5RXR6ITpOA4mf3TGEg.JPEG.arex_blog/SE-f8e6af66-336c-4f05-8898-fdfad91583dc.jpg?type=w800";

        int result = openAiVisionClient.analyzeDosirakRemainPercent(imageUrl);

        System.out.println("잔반 비율 (성공 예상): " + result + "%");
        assertThat(result).isLessThan(10);
    }

    @Test
    @DisplayName("잔반 비율이 10% 이상일 경우 - 인증 실패 기준")
    void analyzeRemainPercent_fail_over10() {
        // 이미지: 음식 많이 남음 (예상)
        String imageUrl = "data:image/jpeg;base64,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";

        int result = openAiVisionClient.analyzeDosirakRemainPercent(imageUrl);

        System.out.println("잔반 비율 (실패 예상): " + result + "%");
        assertThat(result).isGreaterThanOrEqualTo(10);
    }

    @Test
    @DisplayName("숫자가 아닌 응답이 올 경우 예외 발생")
    void analyzeRemainPercent_invalidFormat() {
        // 숫자가 아닌 응답 유도할 수 있는 이미지나 오류 응답
        String imageUrl = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQVf42uP2Ekie-cvONyaTOomc1QCQczzQ_M7Q&s"; // 명확하지 않게 생긴 이미지

        assertThatThrownBy(() -> openAiVisionClient.analyzeDosirakRemainPercent(imageUrl))
                .isInstanceOf(OpenAiVisionException.class)
                .hasMessageContaining("유효한 숫자를 반환하지 않았습니다");
    }

    @Test
    @DisplayName("존재하지 않는 이미지일 경우 예외 발생")
    void analyzeRemainPercent_notFoundImage() {
        // 존재하지 않는 이미지
        String imageUrl = "https://your-s3-bucket.s3.amazonaws.com/non-existent-image.jpg";

        assertThatThrownBy(() -> openAiVisionClient.analyzeDosirakRemainPercent(imageUrl))
                .isInstanceOf(OpenAiVisionException.class)
                .hasMessageContaining("호출 중 오류 발생");
    }
}
